{
  "hash": "90f6b539d74f538e7f14a39a7eee3c1a",
  "result": {
    "engine": "knitr",
    "markdown": "# Graphs and plots\n\n::: {.cell}\n\n:::\n\nThere are two common  ways to plot data in R: either by using the straightforward but rather basic plotting commands from the Base package, or instead delve into the more complex but much  nicer looking functionalities of the `ggplot` package. \n\n## Distributional graphs for continuous variables\n\nPlots such as histograms or box plots are a convenient way to gain a quick overview of the distribution of a variable and are easy  to produce. Going back to the BSA data, we can plot the distribution of left-right political orientations scores with the `hist()` command. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(bsa$leftrigh,freq=FALSE)\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.1-1.png){fig-alt='Unformatted histogram of left-right political orientations scores' width=672}\n:::\n:::\n\n\nThe histogram should appear in the ‘Plot’ tab on the right hand side of the R Studio window. It shows us that political orientations are slightly skewed towards the left. The `freq=FALSE` option requires the y-axis to be expressed in terms of proportions rather than number of observations.\n\nTitles and labels can easily be added:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nhist(bsa$leftrigh,\n     freq=FALSE,\n     main=\"Histogram of political orientations, 2017\",\n     ylab=\"Proportions\",\n     xlab=\"Left-right political orientations score\")\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.2-1.png){fig-alt='Histogram of left vs right political orientations, with title and y axis labels' width=672}\n:::\n:::\n\n\nNote that `main`, `ylab` and `xlab` can be used with any Base R plot commands. \n\nWe can also produce a box and whisker plot of the same variable in order to get a better sense of the distribution of outliers:\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(bsa$leftrigh,\n        # main=\"Box and whisker plot of political orientations\",\n        ylab=\"Left-right political orientations score\"\n)\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.3-1.png){fig-alt='Box and whisker plot of left vs right political orientations, with title and y axis labels' width=672}\n:::\n:::\n\n\nThe generic `plot()` command produces scatterplots. Let's try it with our left-right political orientations score, in conjunction  with `libauth`, a libertarian vs authoritarian scale.\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nplot(bsa$leftrigh,bsa$libauth) ### Scatterplot of left-right political orientations score\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.4.1-1.png){fig-alt='scatterplot of left-right political orientations vs authoritarianism score' width=672}\n:::\n:::\n\n\nThe scatterplot shows us that there is little association between the two variables. However,  slightly fewer respondents simultaneously score  high on the 'authoritarianism' and 'right' scales, perhaps unsurprisingly.  \n\n## Plotting categorical variables\n\nThe generic `plot()` function provides a quick way to produce bar plots of categorical data. For example, we can examine the distribution of political party affiliations (`Politics` variable). In order to do this we convert it into a factor (ie categorical) variable as previously. Some preliminary abbreviating of the factor levels are also required in order for them to be displayed properly. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nbsa$PartyId2.f<-droplevels( # Getting rid of unused factor levels for neater output\n  as_factor(bsa$PartyId2)   # Converting haven labelled variable to factor\n)\nlevels(bsa$PartyId2.f)<-c(\n  \"Con\",\"Lab\",\"Lib Dems\",\"Other\",\"None\", \"Greens\" # Shorter level names\n  ) \n\nplot(bsa$PartyId2.f)\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.5-1.png){fig-alt='Default frequency bar plot of political party affiliation using the plot command' width=672}\n:::\n:::\n\n\nMore advanced plots require the barplot() function, which can be used in conjunction with table(). Whereas table() creates the data that will be plotted, barplot() does the actual plotting. For instance, we can produce the same bar plot, but this time with percentages, by creating a frequency table as we did above in Section 5.2, then plot it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparty.tab<-round(100*prop.table(\n  table(bsa$PartyId2.f)\n),\n1)\n\nparty.tab\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Con      Lab Lib Dems    Other     None   Greens \n    33.5     39.2      6.4      5.1     13.7      2.1 \n```\n\n\n:::\n\n```{.r .cell-code}\nbarplot(party.tab,\n        main=\"Political party affiliation\",\n        ylab=\"Percent\")\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.6-1.png){fig-alt='Neater frequency bar plot of political party affiliation using the barplot command' width=672}\n:::\n:::\n\n\nWe can go further and create plots for two-way contingency tables of party affiliation by gender. This time we will do it in a single command:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\n#t<-xtabs(~PartyId2.f+Rsex.f,bsa)       # First, let's get the contingency table\nt<-xtabs(~Rsex.f+PartyId2.f,bsa)       # First, let's get the contingency table\nbarplot(\n  round(100*\n          prop.table(t,2),              ## Column % (here, gender)\n    1),               ## Rounded to 1 decimal\n  beside = T,     ## Side-by-side bars   \n  main=\"Political party affiliation by gender\",\n  ylab=\"Percent\")\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.7-1.png){fig-alt='Two-way frequency bar plot of political party affiliation by gender using the barplot command' width=672}\n:::\n:::\n\n\n## More advanced plots\nSocial science research often requires more advanced plots in order to conduct more complex analyses, for instance comparing the mean or median value of a continuous outcome across two or more categorical variables. The `ggplot` package  provides one of the most advanced set of tools for plotting data  currently available. A few examples are provided below.\n\n#### Mosaic plot{-}\nMosaic plots provide a visualisation tool for two-way or more contingency tables. The surface of each rectangle, or bar represents the number of observations of the corresponding cells in the contingency table; whereas their length map the relative frequency of the second variable for each category of the first one equivalent to column percentages in a contingency table. In this example below, we will be using the `mosaic()` function from the `vcd` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vcd)                # Loading the vcd package\n\nmosaic(~Rsex.f+PartyId2.f,                            # Variables specified as\n       data=bsa,                                      # in xtabs()\n       highlighting = \"Rsex.f\",                       # What variable to contrast\n       highlighting_fill = c(\"lightblue\", \"#742082\"), # Colours for contrasting\n       direction = c(\"h\", \"v\"),                       # Orientation of the bars\n       labeling= labeling_border(varnames = F,\n                                 abbreviate_labs = T, \n                                 rot_labels = c(0,0,0,0), \n                                 just_labels = c(\"left\", \n                                                 \"left\", \n                                                 \"left\", \n                                                 \"left\")\n                                ) # labelling functions from mosaic. See \n       )                          # help(labeling_border) for more detail   \n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.8-1.png){fig-alt='Mosaic plot of political party affiliation by gender ' width=672}\n:::\n:::\n\n\n#### Three way contingency tables using ggplot2 {-}\n\n  We would like to look at how differences in political party affiliations vary by gender and whether respondents have a degree-level education.\n\nLet us first prepare the data: we need to create the table of result, the proportion of degree vs non degree holders by gender and political party. This is a three-way contingency table, that we can obtain with `ftable()` as shown in Section 5.2, combined with `prop.table()` for the computation of proportions and `round()`.\nAs they are more straightforward to handle in `ggplot`, we convert the table object created by ftable into a data frame. Although we can specify titles and axis labels  in the plotting command, it is preferable  to keep things simple here and have them already in the the data.   \nRather than using the full range of educational achievements recorded in `HEdQual3`, we would like instead to have a dichotomic variable between degree holders and non degree holders. Adding it directly in the ftable command as a boolean expression return a dichotomic variable: \"TRUE\" for Degree educated respondents, and \"FALSE\" for everyone else. We just need to change the levels of this factor variable to make them more intelligible. Finally we change the variable names in our data frame. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nbsa$HEdQual3.f<-droplevels(as_factor(bsa$HEdQual3))\npa<-round(100*\n            prop.table(\n              ftable(bsa$PartyId2.f,bsa$Rsex.f,(bsa$HEdQual3.f==\"Degree\")\n                     ),\n              1),\n          1)\n\npa<-data.frame(pa)\nlevels(pa$Var3)<-c(\"Below\",\"Degree\")\nnames(pa)<-c(\"Affiliation\",\"Gender\",\"Education\",\"Percent\")\npa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Affiliation Gender Education Percent\n1          Con   Male     Below    72.7\n2          Lab   Male     Below    70.1\n3     Lib Dems   Male     Below    50.0\n4        Other   Male     Below    86.5\n5         None   Male     Below    88.8\n6       Greens   Male     Below    43.3\n7          Con Female     Below    82.6\n8          Lab Female     Below    67.3\n9     Lib Dems Female     Below    54.4\n10       Other Female     Below    74.7\n11        None Female     Below    83.9\n12      Greens Female     Below    48.9\n13         Con   Male    Degree    27.3\n14         Lab   Male    Degree    29.9\n15    Lib Dems   Male    Degree    50.0\n16       Other   Male    Degree    13.5\n17        None   Male    Degree    11.2\n18      Greens   Male    Degree    56.7\n19         Con Female    Degree    17.4\n20         Lab Female    Degree    32.7\n21    Lib Dems Female    Degree    45.6\n22       Other Female    Degree    25.3\n23        None Female    Degree    16.1\n24      Greens Female    Degree    51.1\n```\n\n\n:::\n:::\n\nWe are now ready to plot the data.  the `ggplot()` commands usually works as a succession of layers or  options that are added to an initial plot specifications. Each extra layer is added after a `+` sign. In the example below, we specify the data and the aesthetic (ie the main parameters of the plot) with the first command: the x and y variables , and the first grouping variable, education). `geom_bar()` stipulates the bar plot, with the ṕosition=\"dodge\" for the bars to be located side by side (position=\"stack\"would have them on top of each other). Finally, facet_wrap() splits the plot by gender.\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=pa,aes(y=Percent,x=Affiliation,fill=Education))+\n  geom_bar(position=\"dodge\",stat=\"identity\")+\n  facet_wrap(~Gender)+\n  theme_minimal()+                  ### Theme for visualisation\n  scale_fill_manual(values=c(\"#702082\", \"#008755\"))+ ### Custom colours (optional)\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](7_Graphs_files/figure-html/7.10-1.png){fig-alt='Bar plot of political party affiliation by gender and qualification using ggplot' width=672}\n:::\n:::\n\n\n\\newpage",
    "supporting": [
      "7_Graphs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}