{
  "hash": "9f590ba4a69ec6f5776c888bb153b4ee",
  "result": {
    "markdown": "# Opening UKDS datasets in R\n\n\n::: {.cell hash='Opening_cache/docx/setup4_2141a85f5fed7718764d199b57842a7e'}\n\n:::\n\n\n## Essential information\nIn principle, any  dataset whether in CSV, SPSS, SAS, or Stata format can be opened by R. There are a number of issues to consider however:\n  \n  - The `foreign` package has been traditionally used  to import SPSS and Stata datasets into R:\n  u\n  - its `read.spss()` and `write.spss()` functions respectively open and write .sav files. Given that both were developed from  older versions of SPSS, it is therefore advised  to check that their outcome is as expected. In addition:\n  - `read.spss()` does not store the data in a R data frame by default and will require the option         `to.data.frame=T` to be specified.\n- `read.spss()` may sometimes struggle with some numeric format and wrongly attempt to convert them as factor, which will result in error messages. It is therefore advised to limit the maximum number of levels that  will be considered when converting factors  by using  the option   `max.value.labels=`\n\n- `read.dta()` and `write.dta()` respectively open and write Stata files up to version 12. An option to watch for is `convert.factor=T/F` which either will import  Stata categorical variable as their underlying numeric value or instead will convert them into factors, using value labels as levels, which may be an issue for categorical variables with a large number of levels. Users have to bear in mind that the labels will by default sorted alphabetically.\n\n- The `readstata13` package opens  Stata datasets from version 13 onwards with the `read.dta13()` function and offers a more comprehensive set of options. `convert.factor=T/F` has the same effect as in  `read.dta()` from `foreign`.\n- Data frames created with either `read.dta()` or `read.dta13()` have extra information stored as attributes, which maybe useful to retrieve. For instance:\n  ```\n> mydata<-read.dta(\"Some_Stata_dataset.dta\")\n> attributes(mydata)$var.labels ### Retrieves the original Stata variable labels\n```\n\n- Finally the `haven` package opens SPSS, Stata and SAS files with respectively `read_spss()`, `read_dta()` and `read_sas()`. By contrast with the other two packages, it relies on ad hoc data formats and data structures for converting labelled categorical variables and attempts to mimic Stata's value and variable labels. More information is available [here](https://haven.tidyverse.org/reference/read_dta.html).\n\nIn order not to overcomplicate their initial exploration of R we recommend new users to use  `read.spss()` or `read.dta13()` when importing datasets from either SPSS or Stata, rather than the more elaborate functions available in `haven`.\n\n\n\n## The 2017 British Social Attitudes Survey\nFor the rest of this guide, we will use the `British Social Attitudes Survey, 2017, Environment and Politics: Open Access Teaching Dataset`, which can be downloaded from the [UK Data Service website](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8849). We will use  the   SPSS version of the dataset, which will be assumed to be  saved in a `UKDS` folder created inside `Documents` folder. `C:\\\\Users\\\\Your_User_Name_Here\\\\Documents` We will  set this as default working directory. This way, we won’t have to specify the full path of files that we will be opening or saving.  \n\n::: {.cell hash='Opening_cache/docx/3.1_917080829821ab0d78bd15aca7a35f23'}\n\n:::\n\nWe can finally open the file:\n  \n\n\n::: {.cell hash='Opening_cache/docx/3.2_0455cd2f24ac48ba39ae720f869c7044'}\n\n```{.r .cell-code}\nbsa<-read.spss(paste0(datadir,\"8849spss_V1/bsa2017_open_enviropol.sav\"), \n               to.data.frame = TRUE,\n               use.value.labels=TRUE,\n               max.value.labels = 9)  \n\ndim(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3988   25\n```\n:::\n:::\n\n\n##  Understanding the dataset\nAs previously, we can find the number of observations and variables in the dataset by typing the following:\n  \n\n\n::: {.cell hash='Opening_cache/docx/3.3_5433c37d473c905659cb97e54328a98b'}\n\n```{.r .cell-code}\ndim(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3988   25\n```\n:::\n:::\n\n\n\nWe can see that there are 3,988 observations and 25 variables in the BSA dataset.\n\nTyping:\n\n\n::: {.cell hash='Opening_cache/docx/3.4_2df83265b1dfee61288319e597a9de25'}\n\n```{.r .cell-code}\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"bsa\"             \"datadir\"         \"has_annotations\"\n```\n:::\n:::\n\n\n\nwill show us that the object ‘bsa’ has appeared, but what if we want to get the list of all variables in the dataset?  We need to type:\n\n\n::: {.cell hash='Opening_cache/docx/3.5_80ad8b6919ebb86f81a83cc15b3a3316'}\n\n```{.r .cell-code}\nls(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"actchar\"          \"actpol\"           \"carallow\"         \"carenvdc\"        \n [5] \"carnod2\"          \"carreduc\"         \"cartaxhi\"         \"CCBELIEV\"        \n [9] \"ChildHh\"          \"eq_inc_quintiles\" \"govnosa2\"         \"HEdQual3\"        \n[13] \"leftrigh\"         \"libauth\"          \"Married\"          \"PartyId2\"        \n[17] \"plnenvt\"          \"plnuppri\"         \"Politics\"         \"RAgeCat\"         \n[21] \"RClassGp\"         \"Rsex\"             \"Sserial\"          \"Voted\"           \n[25] \"WtFactor\"        \n```\n:::\n:::\n\n\n\nIf we want to get a better sense of the data, we use the `head()`  function which will return the first six rows.\n\n\n::: {.cell hash='Opening_cache/docx/3.6_9892e7beed2e3be66b447953d6d77d93'}\n\n```{.r .cell-code}\nhead(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Sserial   Rsex RAgeCat                   Married ChildHh\n1  290001   Male   35-44 Married/living as married     Yes\n2  290002 Female     65+        Separated/divorced      No\n3  290003 Female   45-54 Married/living as married     Yes\n4  290004 Female   45-54 Married/living as married     Yes\n5  290005   Male     65+             Never married      No\n6  290006 Female   25-34             Never married     Yes\n                          HEdQual3                          eq_inc_quintiles\n1             O level or equiv/CSE 3rd quintile - More than £292, up to £404\n2 Higher educ below degree/A level                                      <NA>\n3                           Degree 3rd quintile - More than £292, up to £404\n4                           Degree 3rd quintile - More than £292, up to £404\n5 Higher educ below degree/A level 4th quintile - More than £404, up to £577\n6 Higher educ below degree/A level              Lowest quintile - Up to £175\n                                   RClassGp\n1 Lower supervisory & technical occupations\n2        Semi-routine & routine occupations\n3          Managerial & professional occups\n4          Managerial & professional occups\n5          Managerial & professional occups\n6          Managerial & professional occups\n                                                                                          CCBELIEV\n1               I believe that climate change is taking place but not as a result of human actions\n2 I believe that climate change is taking place and is, at least partly, a result of human actions\n3                                                                                             <NA>\n4                                                                                             <NA>\n5                                                                                             <NA>\n6                                                                                             <NA>\n  carallow carreduc carnod2 cartaxhi carenvdc plnenvt plnuppri\n1     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n2     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n3     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n4     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n5     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n6     <NA>     <NA>    <NA>     <NA>     <NA>    <NA>     <NA>\n           Politics Voted               actchar                actpol\n1             some,   Yes                 never                 never\n2 ... a great deal,   Yes                  <NA>                  <NA>\n3             some,   Yes                  <NA>                  <NA>\n4 ... a great deal,   Yes once in the past year once in the past year\n5    not very much,   Yes                  <NA>                  <NA>\n6    not very much,   Yes                  <NA>                  <NA>\n                    govnosa2         PartyId2 leftrigh  libauth  WtFactor\n1                      agree           Labour      1.0 4.500000 0.9380587\n2                   disagree           Labour      1.8 4.333333 0.6844214\n3                       <NA>           Labour       NA       NA 0.9060821\n4                      agree           Labour      1.5 2.500000 1.3085513\n5                       <NA> Liberal Democrat      2.0 3.166667 0.4392823\n6 neither agree nor disagree             <NA>      3.0 3.000000 0.5695720\n```\n:::\n:::\n\n\n\n\n\nSingle variables for example, `Rsex` (gender of respondents) may be also summarised with `head()`, which returns as previously the first six observations of the gender variable, whereas typing  \n\n\n\n\n::: {.cell hash='Opening_cache/docx/3.7_3d85e6f4cf78394f5748ad1e1048c6ee'}\n\n```{.r .cell-code}\nhead(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] Male   Female Female Female Male   Female\nLevels: Male Female\n```\n:::\n:::\n\n\nSimply typing the name of a variable as in:  \n```\nbsa$Rsex\n```\nwill list the first 1000 observations of the variable.  Other commands provide more useful information, such as `summary()`.  \n\n\n\n::: {.cell hash='Opening_cache/docx/3.8_9fa8f91c3f629e6ecd4fa7e13e3fe4ca'}\n\n```{.r .cell-code}\nsummary(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Male Female \n  1806   2182 \n```\n:::\n:::\n\n\n\nSummary is a generic function that tailors the most appropriate output  to an object class. As Rsex is a categorical variable. The output of summary() is identical to what we would have obtained with the default tabulation fuction `table()`:\n  \n\n\n::: {.cell hash='Opening_cache/docx/3.9_a5d66c168de0fd293349c7f37598e864'}\n\n```{.r .cell-code}\ntable(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  Male Female \n  1806   2182 \n```\n:::\n:::\n\n\n\nWhen encountering a continuous variable, `summary()` will compute  basic descriptive statistics (mean, median, quartiles, maximum and minimum). For example, in the case of the libertarian-authoritarian scale `libauth`:  \n  \n\n\n::: {.cell hash='Opening_cache/docx/3.10_81a3fb1aed115a671b3738f1bd391291'}\n\n```{.r .cell-code}\nsummary(bsa$libauth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n  1.167   3.000   3.500   3.511   4.000   5.000     775 \n```\n:::\n:::\n\n\n\n\n##  Identifying and selecting variables\nAs we have already seen, variables are objects. R automatically stores variables using the appropriate object class. Categorical variables are ‘Factors’ with ‘Levels’ as categories within these, while continuous variables are ‘Numeric’ types of objects.\nThe `class()` displays the type of an object:.\n\n\n\n::: {.cell hash='Opening_cache/docx/3.11_84c5d2712390da23af2825cc8fc608ce'}\n\n```{.r .cell-code}\nclass(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"factor\"\n```\n:::\n:::\n\n\n\nThe levels() function returns the categories of the variable.\n\n\n::: {.cell hash='Opening_cache/docx/3.12_f21b0ecda534f620450d713a00fc65c1'}\n\n```{.r .cell-code}\nlevels(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Male\"   \"Female\"\n```\n:::\n:::\n\n\n\\newpage\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}