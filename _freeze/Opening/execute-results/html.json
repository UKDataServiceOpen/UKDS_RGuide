{
  "hash": "5cddecfb69d272434faa3865445ecb00",
  "result": {
    "engine": "knitr",
    "markdown": "# Opening datasets in R\n\n::: {.cell}\n\n:::\n\n## Importing files: essential information\n\n### Spreadsheet and text files {-}\n\nIn principle, any  dataset whether in CSV, or spreadsheet format can be imported into R: \n\n- CSV files can be directly imported with read.csv() from Base R.\n- MS Excel spreadsheets can be opened with the `read_excel()` function from the [readXL]() package or opened/written with `read.xlsx()` and `write.xlsx()` from the [xlsx](https://www.rdocumentation.org/packages/xlsx/versions/0.6.5) package.  \n\n- ODS (Open Document Spreadheets)  files  from LibreOffice/OpenOffice Calc can be opened and written with `read_ods()/write_ods()` from the [readODS](https://docs.ropensci.org/readODS/) package.\n\n\n### SAS, SPSS, or Stata {-}\n\nCurrently, the `haven` packages provides the most versatile and straightforward route  to importing data from other mainstream statistical software. SPSS, Stata and SAS files can be opened with respectively `read_spss()`, `read_dta()` and `read_sas()`. The only potential downside is that it relies on ad hoc data formats and data structures for converting labelled categorical variables and attempts to mimic SPSS/Stata's value and variable labels. More information is available [here](https://haven.tidyverse.org/reference/read_dta.html). We will be using it throughout this guide. \n\nFor the record, the `foreign` package used to be the standard for importing MINITAB, SAS, SPSS and Stata datasets into R, but its development ceased in 2000 (Stata version 12).\n\n## The 2017 British Social Attitudes Survey\nIn the remainder of this guide, we will be using the `British Social Attitudes Survey, 2017, Environment and Politics: Open Access Teaching Dataset`, which can be downloaded from the [UK Data Service website](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8849). We will import  the   SPSS version of the dataset, which will be assumed to be  saved in a `UKDS` folder created inside the `Documents` folder on a Windows computer. `C:\\\\Users\\\\Your_User_Name_Here\\\\Documents` We will  set this as default working directory. This way, we won’t have to specify the full path of files that we will be opening or saving.  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"C:\\\\Users\\\\Your_User_Name_Here\\\\Documents\\\\UKDS\")\n```\n:::\n\n\n\nWe can finally open the file:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nbsa<-read_spss(\"8849spss_V1/bsa2017_open_enviropol.sav\"\n               )\n```\n:::\n\nTyping:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"bsa\"\n```\n\n\n:::\n:::\n\n\nwill show us that the object ‘bsa’ has appeared in the environment.\n\n##  Understanding the dataset\nAs previously, we can find the number of observations and variables in the dataset by typing the following:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\ndim(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3988   25\n```\n\n\n:::\n:::\n\n\nWe can see that there are 3988 observations and 25 variables in the dataset.\n\nbut what if we want to get the list of all variables in the dataset?  We need to type:\n\n::: {.cell}\n\n```{.r .cell-code}\nls(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"actchar\"          \"actpol\"           \"carallow\"         \"carenvdc\"        \n [5] \"carnod2\"          \"carreduc\"         \"cartaxhi\"         \"CCBELIEV\"        \n [9] \"ChildHh\"          \"eq_inc_quintiles\" \"govnosa2\"         \"HEdQual3\"        \n[13] \"leftrigh\"         \"libauth\"          \"Married\"          \"PartyId2\"        \n[17] \"plnenvt\"          \"plnuppri\"         \"Politics\"         \"RAgeCat\"         \n[21] \"RClassGp\"         \"Rsex\"             \"Sserial\"          \"Voted\"           \n[25] \"WtFactor\"        \n```\n\n\n:::\n:::\n\n\nIf we want to get a better sense of the data, we use the `head()`  function which will return the first six rows.\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(bsa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 25\n  Sserial Rsex       RAgeCat  Married ChildHh HEdQual3 eq_inc_quintiles RClassGp\n    <dbl> <dbl+lbl>  <dbl+lb> <dbl+l> <dbl+l> <dbl+lb> <dbl+lbl>        <dbl+lb>\n1  290001 1 [Male]   3 [35-4… 1 [Mar… 1 [Yes] 3 [O le…  3 [3rd quintil… 4 [Lowe…\n2  290002 2 [Female] 7 [65+]  2 [Sep… 2 [No]  2 [High… NA               5 [Semi…\n3  290003 2 [Female] 4 [45-5… 1 [Mar… 1 [Yes] 1 [Degr…  3 [3rd quintil… 1 [Mana…\n4  290004 2 [Female] 4 [45-5… 1 [Mar… 1 [Yes] 1 [Degr…  3 [3rd quintil… 1 [Mana…\n5  290005 1 [Male]   7 [65+]  4 [Nev… 2 [No]  2 [High…  4 [4th quintil… 1 [Mana…\n6  290006 2 [Female] 2 [25-3… 4 [Nev… 1 [Yes] 2 [High…  1 [Lowest quin… 1 [Mana…\n# ℹ 17 more variables: CCBELIEV <dbl+lbl>, carallow <dbl+lbl>,\n#   carreduc <dbl+lbl>, carnod2 <dbl+lbl>, cartaxhi <dbl+lbl>,\n#   carenvdc <dbl+lbl>, plnenvt <dbl+lbl>, plnuppri <dbl+lbl>,\n#   Politics <dbl+lbl>, Voted <dbl+lbl>, actchar <dbl+lbl>, actpol <dbl+lbl>,\n#   govnosa2 <dbl+lbl>, PartyId2 <dbl+lbl>, leftrigh <dbl+lbl>,\n#   libauth <dbl+lbl>, WtFactor <dbl>\n```\n\n\n:::\n:::\n\n\n\n\nSingle variables for example, `Rsex` (gender of respondents) may be also summarised with `head()`, which returns as previously the first six observations of the gender variable, whereas typing  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<labelled<double>[6]>: Person 1 SEX\n[1] 1 2 2 2 1 2\n\nLabels:\n value         label\n    -1 skipped or na\n     1          Male\n     2        Female\n     8      Dontknow\n     9       Refusal\n```\n\n\n:::\n:::\n\nSimply typing the name of a variable as in:  \n```\nbsa$Rsex\n```\nwill list the first 1000 observations of the variable.  Other commands provide more useful information, such as `summary()`.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  1.000   1.000   2.000   1.547   2.000   2.000 \n```\n\n\n:::\n:::\n\n\nSummary is a generic function that tailors the most appropriate output  to an object class. As Rsex is a categorical variable. The output of summary() is identical to what we would have obtained with the default tabulation fuction `table()`:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\ntable(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   1    2 \n1806 2182 \n```\n\n\n:::\n:::\n\n\nWhen encountering a continuous variable, `summary()` will compute  basic descriptive statistics (mean, median, quartiles, maximum and minimum). For example, in the case of the libertarian-authoritarian scale `libauth`:  \n  \n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(bsa$libauth)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n  1.167   3.000   3.500   3.511   4.000   5.000     775 \n```\n\n\n:::\n:::\n\n\n\n##  Identifying and selecting variables\nAs we have already seen, variables are objects. R automatically stores variables using the appropriate object class. Categorical variables are ‘Factors’ with ‘Levels’ as categories within these, while continuous variables are ‘Numeric’ types of objects.\nThe `class()` displays the type of an object:.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"haven_labelled\" \"vctrs_vctr\"     \"double\"        \n```\n\n\n:::\n:::\n\n\nThe levels() function returns the categories of the variable.\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(bsa$Rsex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n:::\n\n\n## Factor variables in the haven package\n\nAs we have seen  in the previous chapter, statistical software such as SPSS or Stata treat categorical variables as numerical variables. Values labels are then 'attached',  allocating  a  substantive meaning to these values.\nOn the other hand, R records  categorical variables in objects that are called *factors*. They may be ordered or not.  Factors consist of limited number of integers to which  correspond *levels* ie characters often  describing them used when the factor is displayed. These numbers range from 1 to the number of categories or levels of the factor, and are thefore distinct from the values categorical variables are allocated in codebooks. \n\n\nUnfortunately, there aren't straightforward ways to convert SPSS or Stata labelled categorical variables into R factors. The  approach followed by `haven` package that we use here  is preserve the  numeric values of the original variables, and add *attributes* that  contain the labels and can be manipulated separately. Attributes are a special type of R objects that have a name, and can be read using the `attr()` function. `haven`-converted categorical variables all have a 'label' and 'labels' attribute. The former is the variable description, the latter the value labels.\n\nThese haven-imported numeric variables can be converted into R factors with their levels consisting of  the SPSS or Stata value labels, but whose numeric values will simply reflect their order in the vector of levels.\n\nLet's examine the original variable description and value labels with the `attr()` function.\nWe can do this variable by variable...\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattr(bsa$HEdQual3, \"label\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Highest educational qual obtained - dv\"\n```\n\n\n:::\n:::\n\n\nWe do the same with value labels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattr(bsa$HEdQual3, \"labels\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                          Degree Higher educ below degree/A level \n                               1                                2 \n            O level or equiv/CSE                 No qualification \n                               3                                4 \n                   DK/Refusal/NA \n                               8 \n```\n\n\n:::\n:::\n\n\nThe value labels displayed above include both the text description and the original  numeric value from SPSS/Stata.\n\nFinally, for easier data manipulation, these haven converted 'labelled numeric variables' can be converted into R factors using the `as_factor()` function. Factor levels in the converted variables can consist of either the value labels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(as_factor(bsa$HEdQual3, levels=\"labels\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Degree\"                           \"Higher educ below degree/A level\"\n[3] \"O level or equiv/CSE\"             \"No qualification\"                \n[5] \"DK/Refusal/NA\"                   \n```\n\n\n:::\n:::\n\n\n... or, as in the earlier output, of both the  original SPSS/Stata numeric values and the value labels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(as_factor(bsa$HEdQual3, levels=\"both\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"[1] Degree\"                          \n[2] \"[2] Higher educ below degree/A level\"\n[3] \"[3] O level or equiv/CSE\"            \n[4] \"[4] No qualification\"                \n[5] \"[8] DK/Refusal/NA\"                   \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\\newpage\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}