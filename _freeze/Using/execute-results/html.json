{
  "hash": "88b2f152a48bb8e430d2d3050f765cbc",
  "result": {
    "engine": "knitr",
    "markdown": "# Using R: essential information\n## Download and installation \n\n\n\n\nR can be downloaded for free from the [CRAN website](https://cran.r-project.org/), installed and run like any other application. Versions for  Windows, Mac and Linux are available.  The standard and rather minimalist interface that appears when the programme\nis launched is shown below.\n\n![The standard R interface](pics/screen2.1.jpg){fig.alt=\"Screenshot of the standard R Windows interface\"}\n\nThis interface merely allows the user to type in commands one by one in the\nconsole, and to install packages via pull-down menus.  This setup is however rather minimal, not very ergonomic\nor user friendly.   As with other statistical software, the primary way of\ninteracting with R for most  consist of instead writing code or syntax in files (also called scripts files) that are saved and run whenever needed, which is\nnot directly feasible with the standard R GUI.\n\nWriting R code and running script files is made easier  via an Integrated Development\nEnvironment (IDE) such as\n[RStudio](https://www.rstudio.com/products/rstudio/download/) for beginners to\nintermediate users [Sublime Text](https://www.sublimetext.com/), or the [StatEt module](https://www.eclipse.org/statet/news/)\nfor  [Eclipse](https://www.eclipse.org/downloads/)  for more advanced\nprogrammers. All are free, available for Windows, MacOS and Linux and offer\nusers  a large number of   functionalities, such as syntax\nhighlighting, integration with Github and Markdown/Quarto, and document visualisation. Given that it probably has the largest\nnumber of users and its interface is straightforward for beginners, RStudio will be used in\nthe remainder of this guide. In order for this guide to remain as universal\nas possible, we will not rely on the advanced features of RStudio, instead using\nit merely as an interface to the R engine. \n\n## Installing and setting up RStudio\n\nRStudio needs to be installed separately from R. The program can be downloaded\nfrom  [the RStudio website](https://www.rstudio.com/products/rstudio/download/).\nThe site will automatically generate  a link to the version most compatible with\nthe computer used to access it. Once downloaded double click on the file  and\nfollow the installation instructions. \n\nBy default, the R Studio interface consists of  four main panels, respectively\nknown as the Script Editor (top left panel), the Console (bottom left panel),\nthe Environment (top right panel) and the File/Directory/Help/Viewer (bottom right panel).\n\n![The R Studio default interface](pics/screen2.2.png){fig.alt=\"Screenshot of the standard RStudio interface with four panes: top left: script; bottom left: console; top right: global environment; bottom right: files or help\"}\n\nAs this rather complex interface can be visually overwhelming for some users and is\nnot required for the purpose of  this guide, we will minimise the Global\nEnvironment and Files/Directory/Help panels by clicking in the center of the\nwindow and dragging right to the edge of the screen. This way, only the script\nand console  panels remain visible.   The tiling of the panels can also be customised\nin `Tools>Global Options>Pane Layout`. For instance, Script can be moved to the\nbottom of the window and Console to the top: \n  \n![A customised R Studio interface](pics/screen2.3.png){fig.alt=\"Screenshot of the customised R Studio interface, with the console pane at the top and the script pane at the bottom\"}\n\n## Interacting with R\n\nAs already mentioned, one can type R commands directly in the console of RStudio\nand/or by writing sequences of commands in a script file. \n\nMost R commands -- also known as functions in R jargon -- adopt the following syntax:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\n> command(parameter1, parameter2, ...)\n```\n:::\n\n\nAll R commands are followed by brackets, even if some of them take no parameters. \n\nIn the following example we are going to set up the default working directory, that is  the default location for opening and storing files, by using the `getwd()` and `setwd()` commands. First, let us visualise the current default working directory.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngetwd()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/home/mscsepw2/OneDrive/rguide/UKDS_RGuide\"\n```\n\n\n:::\n:::\n\n\nLet us say we would like the code from this guide to be all in a folder called ‘R_UKDS’, to be located in ‘My Documents’.  To tell R to use the folder ’R_UKDS, we can either create it from within Windows or ask R to do it for us.  So type:\n  \n  For Windows:\n  \n```\n> setwd(\"C:/Documents and Settings/<INSERT YOUR USERNAME HERE>/My Documents/R_UKDS\")\n```\nFor Mac:\n```\n> setwd(\"/Users/<INSERT YOUR USERNAME HERE>/Documents/R_UKDS\")\n```\nFor Linux:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir.create(\"~/Documents/R_UKDS\")\nsetwd(\"~/Documents/R_UKDS\")\n```\n:::\n\n\nTyping `getwd()`  confirms that the change has been recorded.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngetwd()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/home/mscsepw2/OneDrive/rguide/UKDS_RGuide\"\n```\n\n\n:::\n:::\n\n\n**Notes:**\n  \n  - Any character string that is neither a command or the name of an object (such as a variable name) needs to be put between inverted commas or quotation\nmarks, otherwise it will be interpreted as the name of an object and R will return an error.\n\n- see the example below about loading user-created packages;\n\n- Even when no parameters are specified for a command, brackets are compulsory as shown in the `getwd()` example above;\n\n- R uses forward slashes rather than backslashes (unlike Windows applications, but like Linux) to separate directories. Using backlashes will return an\nerror message;\n\n- Although most R commands accept a large number of options to be specified. In many cases default values have been ‘factory set’ so that only the\nessential parameters need specifying.\n\nThe output of most R commands can be either directly displayed on the screen (as in the above example) or stored in objects that can be subsequently reused in\nfurther commands. This object-oriented feature separates R from traditional statistical software.\n\nFor instance, typing:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\na<-getwd()\n```\n:::\n\n\nwill store the output of `getwd()`  (that is, the name of the current default directory) into an object called ‘a’. In order to view the content of a, one can just type its name:\n\n\n::: {.cell}\n\n```{.r .cell-code}\na\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/home/mscsepw2/OneDrive/rguide/UKDS_RGuide\"\n```\n\n\n:::\n:::\n\n\n#### Writing R scripts  via R Studio{-}\n\nMost users will want to write their code in a script file, similar to the ‘do’ file in Stata or syntax file in SPSS.  R script files can be  identified with their .R suffix. To open an existing  R script in RStudio select `File>Open File` then  the relevant script file. To create a new script  select `File>New File>Open File` (shortcut: Control+Shift+N) this will open a new script window in which to type commands.\n\n\n## Installing and loading packages\n\nApart from a basic set of commands and functions, most of the tools offered by R are available in packages that need to be installed and downloaded separately from within R. This can also be done with the pull-down menus of RStudio.  \nFor example, to install the ‘foreign’ package one need to type: \n  \n```\ninstall.packages(\"foreign\",repos = \"https://cloud.r-project.org\")\n```\n\nIf the address of the  package repository is not specified via the  `repos=` option, a pull-down menu will appear, asking for one. Choosing `https://cloud.r-project.org` will automatically select the closest mirror site. Packages installation only needs to be done once. \n\nOriginally, `Foreign`  enabled  users to import Stata (version 12 or older) or SPSS datasets. For Stata datasets saved under version 13 and above as well as more recent SPSS datasets, the `haven` package is  required. \n\n```\ninstall.packages(\"haven\",repos = \"https://cloud.r-project.org\")\n```\nTo use a package already  installed in  the local  R library,  the `library()` command is needed:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\n```\n:::\n\n\nSimply typing:\n  \n```\n> library()\n```\nWill list all libraries installed on the computer that can be loaded in memory. This can be a rather long list!\n  \n  <!-- For users who feel more comfortable using ‘click-and-point', there is also the option to use ‘Install Packages’ from the Packages tab in the main R window. This will display a list of packages available in alphabetical order for the user to choose from. Next, select the desired package, double click on it and press ‘OK’ for the installation to begin. -->\n\nBesides a full archive of R packages, the CRAN website provides a series of manuals,  including [Writing R Extensions](https://cran.r-project.org/doc/manuals/R-exts.html), which describes how users can write their own packages and submit them to CRAN.\n\nOnce a package is installed, it will be permanently stored in the local R library on the computer, unless  deleted it with  the `remove.packages()` command (not advised as this can break dependencies between packages!).\n\n```\n> remove.packages(\"name of the package\")\n```\nPackages required  for an analysis have to be loaded every time a new R session is started (But not every time a syntax file is run!).  \n\n\n##  Using R's internal help system\n\nWithin R, the most straightforward way to request help with a command consists of a question mark followed by the command name, without a space in between.  The standard help system in R (unless using RStudio or Eclipse) relies on the default web browser installed on your computer (ie Chrome, Firefox or Edge in most cases) to display pages. \n\nTyping: \n\n```\n> ?getwd \n```\n\n\nIs equivalent of: \n\n```\nhelp('getwd')\n```\nand will open the help page for the `getwd()` command in the default web browser or the viewer tab of RStudio. \n\n![Help page for getwd()](pics/help_3.png){fig.alt=\"Screenshot of the help page for getwd() in the RStudio viewwer tab\"}\n\nThis will work for any command directly available in the `Base` package that is loaded at startup or  in other packages loaded via the `library()` command. Otherwise, R will return an error message.\n\nTyping two question marks followed by a keyword will search all of R for the available documentation for that keyword in the installed packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n??haven\n```\n:::\n\n![Results of help search for 'haven'](pics/help_2.png){fig.alt=\"Screenshot of the results in RStudio  of a search for 'haven' in the  help content of R \"}\n\n\nAn index of all commands and functions in the foreign package can be obtained by typing:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelp(package='haven')\n```\n:::\n\n![Help content index for the *haven* package](pics/help_1.png){fig.alt=\"RStudio viewer tab screenshot of the help index for the 'haven' package\"}\n\n\nNote: this command only works because the `haven` package was previously loaded in memory with the `library()` command. \n\nMore information about where to find help when using R is provided at the end of this document.\n\n\n## Objects\nR is an object oriented language, which means that almost any information it uses is stored as ‘objects’ (i.e. containers) that can be manipulated independently. During an R session, multiple objects are available simultaneously (for instance datasets, but also summary tables or new variables produced from it). \nTyping:\n```\n> ls()\n```\nwill list all the objects that are currently in memory.\n\nObjects belong to `classes` or types which have distinct `properties`. There are many classes of objects in R. By comparison, Stata has only macros, variables and scalars that are directly  available to most users. Common object classes include:\n\n- factors: these are equivalent to categorical variables (see below);\n- numeric: numerical variables – whether continuous or ordinal;\n- character: alphanumeric variables;\n- vectors: a list of items that are of the same type;\n- lists: more complex list of objects, functions or datasets\n- data frames (datasets); \n- matrices, etc. \n\nSome operations are understandably only possible with certain types of objects. \n\nMore advanced users can also create their own object classes. Describing R objects and their properties is well beyond the purpose of this guide and users interested should consult the [online documentation](https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects) for further explanations.\n\nTo create or assign a value to an object, one uses the assignment operator  (<-). For example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- 5  \n\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n```\n\n\n:::\n\n```{.r .cell-code}\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"a\" \"x\"\n```\n\n\n:::\n:::\n\n\nIn this example we have assigned the value 5 to an object called x. If you type the letter x,  the value ‘5’ will be returned in your console. The object x will appear in the R environment after the ls() command. \n\n\n#### Deleting objects  {-}\nThe `rm()` function can be used to remove objects from the environment (session). These objects can be variables, lists, datasets, etc. For instance, to remove the object ‘x’, or the fictitious dataset called ‘mydata’:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(x)\t\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncharacter(0)\n```\n\n\n:::\n:::\n\n\n```\n> rm(mydata)\n```\n<!-- The rm() function only works with R objects; but if you want to delete a specific variable of a dataset, you need a different function. For example, to delete the variable ‘age’ of the dataset ‘mydata’, an option is to set the variable to NULL: -->\n\n<!-- > mydata$age<-NULL -->\n\n<!-- There are other ways to delete variables from a dataset, but these will be looked at later on in this guide. -->\n\n#### Data frames {-}\n\nAmong the various classes of objects one may use in R, a few are essential to understand when analysing survey data. Their characteristics are briefly listed below;\n\nData frames are  objects that come closest to datasets in traditional statistical software or worksheets in Microsoft Excel or LibreOffice Calc. They are objects that have indexed rows and columns, both of which may have names. Data frames  columns can be seen as  variables and lines or rows as observations. Each  cell in the data frame can be uniquely identified by its position. Data frames are typically the object in which survey datasets are stored.\n\n\n\n::: {.cell}\n\n:::\n\n\nLet's assume that we have a  small data frame called 'mydata'. Here are  a few basic commands to examine it:\n  \n**Determining the size of a data frame:** \n\nthe `dim()` command returns the number of rows and columns of a data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(mydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 50  6\n```\n\n\n:::\n:::\n\nR tells us that our data is made of 50 rows and 6 columns, in other words of 50 observations and 6 variables. What if I want a quick overview of the dataset?\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nhead(mydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    RSex skipmeal                   Married       Poverty1\n1 Female       NA Married/living as married        Was not\n2 Female        1        Separated/divorced        Was not\n3 Female       NA Married/living as married        Was not\n4   Male       NA             Never married        Was not\n5   Male        1             Never married        Was not\n6   Male       NA Married/living as married Was in poverty\n                          HEdQual3 NatFrEst\n1 Higher educ below degree/A level        5\n2 Higher educ below degree/A level       30\n3             O level or equiv/CSE       50\n4 Higher educ below degree/A level       50\n5                 No qualification       50\n6                             <NA>       10\n```\n\n\n:::\n:::\n\nThe `head()` command displays the first  six lines of the dataset. Depending on the number of variables  the output of   `head()` can become quickly overwhelming, as the size of the lines on most screens is limited!\n  \n  **Obtaining the names of variables (or columns) in the dataset:**\n  This can be done using either  `ls()` which we already have used, or the `names()` commands. `ls()` returns the variables names, sorted alphabetically, whereas `names()` returns them in their actual order in the data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nls(mydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"HEdQual3\" \"Married\"  \"NatFrEst\" \"Poverty1\" \"RSex\"     \"skipmeal\"\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(mydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"RSex\"     \"skipmeal\" \"Married\"  \"Poverty1\" \"HEdQual3\" \"NatFrEst\"\n```\n\n\n:::\n:::\n\nWe can see that in the data frame, the \"RSex\" column comes in fact before \"Poverty1\".\n\n**Accessing variables:**\n  \n  Columns of a data frame, or variables, can be accessed by their name preceded by the $ sign: \n  \n\n::: {.cell}\n\n```{.r .cell-code}\nmydata$NatFrEst\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  5 30 50 50 50 10  1 NA  5 50 60 25 30  3 25 10 80  5 50 50 40 45  2 82 60\n[26] 40 10 10 40 15 30 30  2 10 75 99 70 50 10 30  1 10 85 45 70 25 40 30 10 25\nattr(,\"value.labels\")\nnamed numeric(0)\n```\n\n\n:::\n:::\n\nLists all values of `NatFrEst`, as well as extra technical information at the bottom.\n\nAlternatively, columns/variables and rows can be identified numerically by their position in the data frame using square brackets: \n```\ndataframe[row number,column number]\n```\nGiven that `RSex` is the first column of our dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmydata[,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] Female Female Female Male   Male   Male   Male   Female Male   Male  \n[11] Male   Female Female Male   Female Female Female Female Female Female\n[21] Male   Female Female Male   Male   Female Female Female Female Male  \n[31] Female Female Female Female Male   Male   Female Female Male   Female\n[41] Male   Male   Female Male   Female Male   Female Female Female Male  \nLevels: Male Female\n```\n\n\n:::\n:::\n\nReturns the same output as previously. Not specifying a row or column name within the square brackets tells R to display them all.   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmydata[6,]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  RSex skipmeal                   Married       Poverty1 HEdQual3 NatFrEst\n6 Male       NA Married/living as married Was in poverty     <NA>       10\n```\n\n\n:::\n:::\n\nReturns the values of all the variables for the sixth row of the data frame. Specifying both a row and column number, will return a unique observation: \n  \n\n::: {.cell}\n\n```{.r .cell-code}\nmydata[6,6]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 10\n```\n\n\n:::\n:::\n\nwhich in this case is 10. \nFinally, more than one column or row can be displayed by concatenating their number using the `c()` function:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nmydata[c(6,9),c(1,6)]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  RSex NatFrEst\n6 Male       10\n9 Male        5\n```\n\n\n:::\n:::\n\nThe above command returns respectively the sixth and 9th observations for the  sixth column. Please note that columns names can also be used instead of their number, provided that they are put between inverted commas:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nmydata[c(6,9),c('RSex','NatFrEst')]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  RSex NatFrEst\n6 Male       10\n9 Male        5\n```\n\n\n:::\n:::\n\nReturns the same result as previously.\nHaving a data frame to hand allows us to explore other types of objects commonly found in R. The type of a variable can  be displayed  by simply using the `class()` function. \n\n#### Numeric {-}\n\n`Numeric` objects are simple numerical vectors (ie a single or a list of numbers). Here this is the case for `NatFrEst`, the estimated proportion of people making wrong benefits claims, according to respondents to the survey.  \n\n::: {.cell}\n\n```{.r .cell-code}\nclass(mydata$NatFrEst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"numeric\"\n```\n\n\n:::\n:::\n\n#### Character {-}\nCharacter objects are alphanumeric vectors, that is variables which consist of text string(s).\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(mydata$Married)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"character\"\n```\n\n\n:::\n:::\n\n#### Factors {-}\nA distinctive feature of R is that categorical variables whether ordinal or polynomial are stored in objects known as **factors**. Factors  should be thought of  as a special type of variable with a discrete set of values, known as `levels`. Factors can be unordered or ordered. In our data, `Rsex` (Gender of the respondent) is such an object:   \n\n::: {.cell}\n\n```{.r .cell-code}\nclass(mydata$RSex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"factor\"\n```\n\n\n:::\n:::\n\nThe main difference between factors and traditional categorical variables in Stata or SPSS is that they do **not** consist of arbitrary numerical values with which substantive value labels are associated. \n\nLet's further examine this factor. It is always a good idea to check the ordering of factor levels in a newly created variable with the `level()` command.o\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(mydata$RSex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Male\"   \"Female\"\n```\n\n\n:::\n:::\n\nreturns the levels (ie the values) of  `RSex`. 'Male' is the first level of `Rsex`,\nand 'Female' the second one, irrespective of the values originally assigned and described in the codebook of the  dataset. \nIt is possible to change the ordering of factor\nlevels with the `factor()` function.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmydata$RSex.New<-mydata$RSex     ## We first create the new variable\nmydata$RSex.New<-factor(mydata$RSex, ## Then reorder the factor levels\n                        levels = levels(mydata$RSex)[c(2,1)])\n```\n:::\n\nThe above code tells R to create a new factor variable -`RSex.New` - whose levels are the same as the initial `RSex`, but with  'Female' (level number 2 in the original variable) coming first, and \"Male\" (level number 1) , second. The name of the new variable is arbitrary. \n\nWe can check the outcome:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(mydata$RSex.New)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncharacter(0)\n```\n\n\n:::\n:::\n\n\nIn the next chapter an alternative approach to dealing with categorical variables imported from SPSS or Stata is presented.\n\n\\newpage  ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}